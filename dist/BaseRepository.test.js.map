{"version":3,"sources":["../dist-esnext/BaseRepository.test.js"],"names":["MONGO_URL","baseRepository","describe","beforeEach","it","entity","id","save","entityDb","getById","newName","query","email","find","limit","i","testLimit","entitiesDb","length","entities","push","getByIds"],"mappings":"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","file":"BaseRepository.test.js","sourcesContent":["import { equal, ok } from 'ptz-assert';\r\nimport { createRepository } from './index';\r\nconst MONGO_URL = 'mongodb://localhost:27017/ptz-core-repo';\r\nvar baseRepository;\r\n/* tslint:disable:no-string-literal */\r\ndescribe('BaseRepository', () => {\r\n    beforeEach(async () => {\r\n        baseRepository = await createRepository('test-collection', MONGO_URL);\r\n    });\r\n    describe('save', () => {\r\n        it('insert', async () => {\r\n            const entity = {\r\n                id: 'testid'\r\n            };\r\n            await baseRepository.save(entity);\r\n            const entityDb = await baseRepository.getById(entity.id);\r\n            ok(entityDb);\r\n            equal(entityDb.id, entity.id);\r\n        });\r\n        it('update', async () => {\r\n            const entity = {\r\n                id: 'testid'\r\n            };\r\n            entity['name'] = 'teste';\r\n            await baseRepository.save(entity);\r\n            const newName = 'teste2';\r\n            entity['name'] = newName;\r\n            await baseRepository.save(entity);\r\n            const entityDb = await baseRepository.getById(entity.id);\r\n            ok(entityDb);\r\n            equal(entityDb.id, entity.id);\r\n            equal(entityDb['name'], newName);\r\n        });\r\n    });\r\n    describe('find', () => {\r\n        it('by Email', async () => {\r\n            const entity = {\r\n                id: 'testid'\r\n            };\r\n            entity['email'] = 'angeloocana@gmail.com';\r\n            await baseRepository.save(entity);\r\n            const query = {\r\n                email: entity['email']\r\n            };\r\n            const entityDb = await baseRepository.find(query, { limit: 1 });\r\n            ok(entityDb[0]);\r\n            equal(entityDb[0]['email'], entity['email']);\r\n        });\r\n        it('limit by 3', async () => {\r\n            for (let i = 0; i <= 6; i++) {\r\n                const entity = {\r\n                    id: 'test' + i\r\n                };\r\n                entity['testLimit'] = true;\r\n                entity['i'] = i;\r\n                await baseRepository.save(entity);\r\n            }\r\n            const query = {\r\n                testLimit: true\r\n            };\r\n            const entitiesDb = await baseRepository.find(query, { limit: 3 });\r\n            equal(entitiesDb.length, 3);\r\n        });\r\n    });\r\n    describe('getByIds', () => {\r\n        it('get 3 entities by ids', async () => {\r\n            const entities = [];\r\n            for (let i = 0; i <= 6; i++) {\r\n                const entity = {\r\n                    id: 'test' + i\r\n                };\r\n                entity['i'] = i;\r\n                entities.push(entity);\r\n                await baseRepository.save(entity);\r\n            }\r\n            const entitiesDb = await baseRepository.getByIds([\r\n                entities[0].id, entities[1].id, entities[2].id\r\n            ]);\r\n            equal(entitiesDb.length, 3);\r\n        });\r\n    });\r\n});\r\n/* tslint:enable:no-string-literal */\r\n//# sourceMappingURL=BaseRepository.test.js.map"]}